<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARK Wireless Queue System</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { 
            --registrar-color: #2563eb; 
            --finance-color: #059669; 
            --dark: #0f172a; 
            --body-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
        }
        
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--body-bg); color: var(--text-main); overflow: hidden; }
        
        /* HEADER */
        .inst-header { 
            background: white; padding: 25px 40px; border-bottom: 6px solid var(--registrar-color); 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.08); gap: 10px;
        }
        .school-logo { height: 80px; width: auto; }
        .inst-header h1 { margin: 0; font-size: 2.2rem; font-weight: 800; color: var(--dark); text-transform: uppercase; letter-spacing: 1px; text-align: center; }
        
        .header-right { position: absolute; right: 30px; top: 30px; z-index: 100; }
        .admin-icon { cursor: pointer; width: 30px; height: 30px; fill: #cbd5e1; transition: fill 0.3s; }
        .admin-icon:hover { fill: var(--registrar-color); }

        /* NAV MENU */
        nav { background: var(--dark); padding: 10px; display: none; gap: 10px; justify-content: center; border-bottom: 1px solid #334155; }
        nav.show-menu { display: flex; }
        nav button { background: #334155; color: white; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-reset { background: #f59e0b !important; }

        .view { display: none; min-height: 80vh; padding: 20px; box-sizing: border-box; }
        .view.active { display: flex; flex-direction: column; align-items: center; }

        /* KIOSK & MODAL */
        .kiosk-card { background: white; padding: 50px; border-radius: 30px; color: var(--dark); text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 450px; margin-top: 40px; }
        .name-input { width: 100%; padding: 15px; font-size: 1.5rem; border-radius: 12px; border: 2px solid #e2e8f0; margin-bottom: 25px; text-align: center; box-sizing: border-box; }

        #ticketModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 40px; border-radius: 40px; text-align: center;
            width: 90%; max-width: 500px; box-shadow: 0 0 50px rgba(37, 99, 235, 0.3);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-ticket { font-size: 7rem; font-weight: 900; color: var(--registrar-color); margin: 20px 0; font-family: monospace; }

        /* STAFF PANEL CUSTOM STYLES */
        .queue-badge {
            background: #f1f5f9;
            color: var(--text-main);
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }
        .count-number { font-weight: 800; color: var(--registrar-color); }

        /* MONITOR UI */
        .monitor-container { display: flex; width: 100%; height: 75vh; gap: 20px; margin-top: 15px; }
        .monitor-panel { flex: 1; display: flex; flex-direction: column; border-radius: 30px; background: var(--card-bg); border: 1px solid #e2e8f0; overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .mon-number { font-size: 11rem; font-weight: 900; font-family: monospace; color: var(--registrar-color); margin: -10px 0; }
        .mon-name { font-size: 3rem; font-weight: 700; text-transform: capitalize; color: var(--dark); }
        
        .waiting-list { flex: 1.2; padding: 20px; background: #f1f5f9; }
        .waiting-row { display: flex; justify-content: space-between; padding: 15px; background: white; border-radius: 15px; margin-bottom: 10px; border: 1px solid #e2e8f0; font-size: 1.2rem; }
        .wait-ticket { font-weight: 800; color: var(--registrar-color); font-size: 1.6rem; }
        .call-btn { width: 220px; height: 220px; border-radius: 50%; color: white; font-weight: 900; cursor: pointer; border: 8px solid #f1f5f9; font-size: 1.2rem; }
    </style>
</head>
<body>

<div id="ticketModal">
    <div class="modal-content">
        <h2 style="margin:0; color:var(--text-muted);">YOUR TICKET NUMBER</h2>
        <div class="modal-ticket" id="displayTicket">R001</div>
        <div class="modal-name" id="displayName">Juan Dela Cruz</div>
        <p class="modal-instruction">Please take a photo of your ticket.</p>
        <button onclick="closeModal()" style="background:var(--dark); color:white; border:none; padding:15px 40px; border-radius:15px; font-weight:bold; cursor:pointer; font-size:1.2rem;">GOT IT</button>
    </div>
</div>

<header class="inst-header">
    <img src="images/logo.png" alt="ARK Logo" class="school-logo">
    <h1>ARK Technological Institute Education System Inc.</h1>
    <div class="header-right">
        <svg class="admin-icon" onclick="unlockMenu()" viewBox="0 0 24 24">
            <path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
            <path d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z"/>
        </svg>
    </div>
</header>

<nav id="mainNav">
    <button onclick="showView('kioskView')">KIOSK MODE</button>
    <button onclick="showView('staffView')">STAFF PANEL</button>
    <button onclick="showView('monitorView')">MONITOR SCREEN</button>
    <button onclick="resetSystem()" class="btn-reset">RESET ALL NUMBERS</button>
</nav>

<div id="kioskView" class="view">
    <div class="kiosk-card">
         <h3 style="font-size: 2rem; margin-bottom: 20px;">Enter Your Name to get a Ticket Number</h3>
<p style="font-size: 20px; margin-bottom: 20px; font-style: italic;"> Press the button of the selected transaction.</p>
        <input type="text" id="studentName" class="name-input" placeholder="Enter Full Name">
        <button onclick="generateTicket('REGISTRAR', 'R')" style="background:var(--registrar-color); width:100%; padding:25px; color:white; border:none; border-radius:15px; cursor:pointer; font-weight:bold; font-size:1.4rem;">REGISTRAR</button>
        <button onclick="generateTicket('FINANCE', 'F')" style="background:var(--finance-color); width:100%; padding:25px; color:white; border:none; border-radius:15px; cursor:pointer; margin-top:15px; font-weight:bold; font-size:1.4rem;">FINANCE</button>
    </div>
</div>

<div id="staffView" class="view">
    <div style="display:flex; width:100%; max-width:1000px; background:white; color:#000; border-radius:30px; overflow:hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.15); height: 500px;">
        <div style="width:220px; background:#f1f5f9; padding:25px; border-right: 1px solid #e2e8f0; display:flex; flex-direction:column;">
            <button onclick="switchDept('REGISTRAR')" style="width:100%; padding:15px; margin-bottom:15px; cursor:pointer; border-radius:12px; border:1px solid #cbd5e1; font-weight:bold;">REGISTRAR</button>
            <button onclick="switchDept('FINANCE')" style="width:100%; padding:15px; cursor:pointer; border-radius:12px; border:1px solid #cbd5e1; font-weight:bold;">FINANCE</button>
        </div>
        <div style="flex:1; padding:70px; text-align:center;">
            
            <div id="ws-REGISTRAR" class="dept-ws">
                <h2 style="color:var(--registrar-color); font-size: 2rem; margin-bottom: 5px;">Registrar Counter</h2>
                <div class="queue-badge">Customers in line: <span id="count-REGISTRAR" class="count-number">0</span></div>
                
                <div id="current-name-REGISTRAR" style="margin: 20px 0; font-size: 2rem; font-weight: bold; background: #f8fafc; padding: 20px; border-radius: 15px;">---</div>
                <button class="call-btn" style="background:var(--registrar-color)" onclick="callNext('REGISTRAR')">CALL NEXT</button>
            </div>

            <div id="ws-FINANCE" class="dept-ws" style="display:none;">
                <h2 style="color:var(--finance-color); font-size: 2rem; margin-bottom: 5px;">Finance Counter</h2>
                <div class="queue-badge">Customers in line: <span id="count-FINANCE" class="count-number" style="color:var(--finance-color)">0</span></div>
                
                <div id="current-name-FINANCE" style="margin: 20px 0; font-size: 2rem; font-weight: bold; background: #f8fafc; padding: 20px; border-radius: 15px;">---</div>
                <button class="call-btn" style="background:var(--finance-color)" onclick="callNext('FINANCE')">CALL NEXT</button>
            </div>

        </div>
    </div>
</div>

<div id="monitorView" class="view active">
    <div class="monitor-container">
        <div class="monitor-panel">
            <div style="flex:3; display:flex; flex-direction:column; justify-content:center; align-items:center; padding: 20px;">
                <div style="color:var(--registrar-color); font-weight:900; font-size: 2rem; letter-spacing: 3px;">REGISTRAR</div>
                <div class="mon-number" id="mon-num-REGISTRAR">---</div>
                <div class="mon-name" id="mon-name-REGISTRAR">Please wait to call your Ticker Number</div>
            </div>
            <div class="waiting-list">
                <div id="next-list-REGISTRAR"></div>
            </div>
        </div>
        <div class="monitor-panel">
            <div style="flex:3; display:flex; flex-direction:column; justify-content:center; align-items:center; padding: 20px;">
                <div style="color:var(--finance-color); font-weight:900; font-size: 2rem; letter-spacing: 3px;">FINANCE</div>
                <div class="mon-number" id="mon-num-FINANCE" style="color:var(--finance-color)">---</div>
                <div class="mon-name" id="mon-name-FINANCE">Please wait to call your Ticker Number</div>
            </div>
            <div class="waiting-list">
                <div id="next-list-FINANCE"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDrySDxpUqTMAzom9o1B3ZaGkL__2kx19A",
        authDomain: "ark-queue-system.firebaseapp.com",
        databaseURL: "https://ark-queue-system-default-rtdb.firebaseio.com",
        projectId: "ark-queue-system",
        storageBucket: "ark-queue-system.firebasestorage.app",
        messagingSenderId: "1087161355859",
        appId: "1:1087161355859:web:f17ab0505bc100d0f440a6",
        measurementId: "G-XXEPW2FK59"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function unlockMenu() { 
        if(prompt("Enter Admin Password:") === "") {
            document.getElementById('mainNav').classList.add('show-menu');
        } 
    }

    function showView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('mainNav').classList.remove('show-menu');
    }

    async function resetSystem() {
        if(confirm("Reset entire system?")) {
            await db.ref('/').update({
                'last_REGISTRAR': 0, 'last_FINANCE': 0,
                'waiting_REGISTRAR': null, 'waiting_FINANCE': null,
                'currentCall': { ticket: '---', name: 'Welcome', dept: 'NONE', time: 0 }
            });
            location.reload();
        }
    }

    async function callNext(dept) {
        const snap = await db.ref('waiting_' + dept).limitToFirst(1).get();
        if(snap.exists()) {
            const key = Object.keys(snap.val())[0];
            const data = snap.val()[key];
            await db.ref('waiting_' + dept + '/' + key).remove();
            await db.ref('currentCall').set({ ticket: data.ticket, name: data.name, dept: dept, time: Date.now() });
        } else {
            alert("No customers in the " + dept + " queue.");
        }
    }

    db.ref('currentCall').on('value', (snap) => {
        const data = snap.val();
        if(data && data.dept !== "NONE") {
            document.getElementById('mon-num-' + data.dept).innerText = data.ticket;
            document.getElementById('mon-name-' + data.dept).innerText = data.name;
            // Update staff name display too
            const staffNameDisplay = document.getElementById('current-name-' + data.dept);
            if(staffNameDisplay) staffNameDisplay.innerText = data.name + " (" + data.ticket + ")";

            if (Date.now() - data.time < 2000) {
                window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(`Now serving, ${data.name}, ticket ${data.ticket}`);
                window.speechSynthesis.speak(msg);
            }
        }
    });

    ['REGISTRAR', 'FINANCE'].forEach(dept => {
        db.ref('waiting_' + dept).on('value', (snap) => {
            const listEl = document.getElementById('next-list-' + dept);
            const countEl = document.getElementById('count-' + dept); // Get staff counter element
            
            listEl.innerHTML = "";
            let count = 0;

            snap.forEach(child => {
                count++;
                const row = child.val();
                const div = document.createElement('div');
                div.className = 'waiting-row';
                div.innerHTML = `<span>${row.name}</span><span class="wait-ticket">${row.ticket}</span>`;
                listEl.appendChild(div);
            });

            // Update the "Customers in line" display in Staff Panel
            if(countEl) countEl.innerText = count;
        });
    });

    function switchDept(dept) {
        document.querySelectorAll('.dept-ws').forEach(d => d.style.display = 'none');
        document.getElementById('ws-' + dept).style.display = 'block';
    }

    async function generateTicket(dept, prefix) {
        const nameInput = document.getElementById('studentName');
        const name = nameInput.value.trim();
        if(!name) return alert("Please enter your name first!");

        const snap = await db.ref('last_' + dept).get();
        let num = (snap.val() || 0) + 1;
        const ticketID = prefix + num.toString().padStart(3, '0');

        await db.ref('last_' + dept).set(num);
        await db.ref('waiting_' + dept).push({ ticket: ticketID, name: name });
        
        document.getElementById('displayTicket').innerText = ticketID;
        document.getElementById('displayTicket').style.color = (dept === 'FINANCE') ? 'var(--finance-color)' : 'var(--registrar-color)';
        document.getElementById('displayName').innerText = name;
        document.getElementById('ticketModal').style.display = 'flex';
        
        nameInput.value = ""; 
        setTimeout(closeModal, 10000);
    }

    function closeModal() {
        document.getElementById('ticketModal').style.display = 'none';
    }
</script>
</body>
</html>







